function base64encode(e){var r,a,t,o,d,i;for(t=e.length,a=0,r="";t>a;){if(o=255&e.charCodeAt(a++),a==t){r+=base64EncodeChars.charAt(o>>2),r+=base64EncodeChars.charAt((3&o)<<4),r+="==";break}if(d=e.charCodeAt(a++),a==t){r+=base64EncodeChars.charAt(o>>2),r+=base64EncodeChars.charAt((3&o)<<4|(240&d)>>4),r+=base64EncodeChars.charAt((15&d)<<2),r+="=";break}i=e.charCodeAt(a++),r+=base64EncodeChars.charAt(o>>2),r+=base64EncodeChars.charAt((3&o)<<4|(240&d)>>4),r+=base64EncodeChars.charAt((15&d)<<2|(192&i)>>6),r+=base64EncodeChars.charAt(63&i)}return r}function base64decode(e){var r,a,t,o,d,i,n;for(i=e.length,d=0,n="";i>d;){do r=base64DecodeChars[255&e.charCodeAt(d++)];while(i>d&&-1==r);if(-1==r)break;do a=base64DecodeChars[255&e.charCodeAt(d++)];while(i>d&&-1==a);if(-1==a)break;n+=String.fromCharCode(r<<2|(48&a)>>4);do{if(t=255&e.charCodeAt(d++),61==t)return n;t=base64DecodeChars[t]}while(i>d&&-1==t);if(-1==t)break;n+=String.fromCharCode((15&a)<<4|(60&t)>>2);do{if(o=255&e.charCodeAt(d++),61==o)return n;o=base64DecodeChars[o]}while(i>d&&-1==o);if(-1==o)break;n+=String.fromCharCode((3&t)<<6|o)}return n}function utf16to8(e){var r,a,t,o;for(r="",t=e.length,a=0;t>a;a++)o=e.charCodeAt(a),o>=1&&127>=o?r+=e.charAt(a):o>2047?(r+=String.fromCharCode(224|o>>12&15),r+=String.fromCharCode(128|o>>6&63),r+=String.fromCharCode(128|o>>0&63)):(r+=String.fromCharCode(192|o>>6&31),r+=String.fromCharCode(128|o>>0&63));return r}function utf8to16(e){var r,a,t,o,d,i;for(r="",t=e.length,a=0;t>a;)switch(o=e.charCodeAt(a++),o>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:r+=e.charAt(a-1);break;case 12:case 13:d=e.charCodeAt(a++),r+=String.fromCharCode((31&o)<<6|63&d);break;case 14:d=e.charCodeAt(a++),i=e.charCodeAt(a++),r+=String.fromCharCode((15&o)<<12|(63&d)<<6|(63&i)<<0)}return r}function makeFlag(e,r){if(e){var a=r[0],t=r[1],o=game.add.bitmapData(flagWidth,flagHeight);o.rect(0,0,flagWidth,flagHeight,"#55ff55"),o.text(e,15,25,"20px 宋体","black",!1);var d=marginLeft+(flagWidth+2*flagMargin)*t,i=marginTop+(flagHeight+2*flagMargin)*a,n=game.add.sprite(d,i,o);return n.i=a,n.j=t,n.inputEnabled=!0,n.events.onInputOver.add(function(){borderGraphics.lineStyle(borderWidth,16777215,1),borderGraphics.moveTo(n.x+2-borderWidth,n.y+2-borderWidth),borderGraphics.lineTo(n.x+2+flagWidth,n.y+2-borderWidth),borderGraphics.lineTo(n.x+2+flagWidth,n.y+2+flagHeight),borderGraphics.lineTo(n.x+2-borderWidth,n.y+2+flagHeight),borderGraphics.lineTo(n.x+2-borderWidth,n.y+2-borderWidth)},this),n.events.onInputOut.add(function(){borderGraphics.clear()},this),n.events.onInputUp.add(function(){if(selected){var e=coredata[5*selected.i+selected.j];coredata[5*selected.i+selected.j]=coredata[5*n.i+n.j],coredata[5*n.i+n.j]=e,$("#savejql").prop("href",datauriPrefix+base64encode(prefix+coredata)),timer.stop(),timer.destroy(),selected.visible=!0;var r,a;r=selected.x,a=selected.y,selected.x=n.x,selected.y=n.y,n.x=r,n.y=a,selected=null}else selected=n,timer=game.time.create(!1),timer.loop(500,function(){selected.visible=!selected.visible},this),timer.start()},this),n}}function preload(){}function create(){for(var e in coredata)flagElements.push(makeFlag(hex2flag[coredata[e]],[Math.floor(e/5),Math.floor(e%5)]));$("#savejql").prop("href",datauriPrefix+base64encode(prefix+coredata)),borderGraphics=game.add.graphics(0,0)}function update(){if(coredataChanged){for(var e in flagElements){var r=flagElements[e];r&&r.destroy()}flagElements=[];for(var a in coredata)flagElements.push(makeFlag(hex2flag[coredata[a]],[Math.floor(a/5),Math.floor(a%5)]));$("#savejql").prop("href",datauriPrefix+base64encode(prefix+coredata)),coredataChanged=!1}}var base64EncodeChars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",base64DecodeChars=new Array(-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,-1,-1,-1,-1,-1),game,marginLeft=80,marginTop=80,flagWidth=100,flagHeight=50,flagMargin=10,selected,timer,borderWidth=5,borderGraphics,prefix="QQGame JQL File\x00W\x00\x00",datauriPrefix="data:text/plain;base64,",coredata=[7,11,10,9,12,4,0,13,0,5,6,4,0,13,9,8,0,10,0,11,12,7,8,13,3,3,2,3,12,11].map(function(e){return String.fromCharCode(e)}).join(""),coredataChanged=!1,flagElements=[],flag2hex={"司令":"","军长":"","师长":"","旅长":"\b","团长":"	","营长":"\n","连长":"","排长":"\f","工兵":"\r","炸弹":"","地雷":"","军棋":"","":"\x00"},hex2flag={"":"司令","":"军长","":"师长","\b":"旅长","	":"团长","\n":"营长","":"连长","\f":"排长","\r":"工兵","":"炸弹","":"地雷","":"军棋","\x00":""};$(function(){game=new Phaser.Game(800,600,Phaser.AUTO,"content",{preload:preload,create:create,update:update})});var reader,filedata;$("#loadjql").on("change",function(){var e=document.getElementById("loadjql");return e&&e.files&&e.files[0]&&reader.readAsBinaryString(e.files[0]),!1}),$(function(){reader=new FileReader,reader.onload=function(){if(filedata=this.result,50!=this.result.length||!this.result.startsWith(prefix))return alert("这不是一个军棋布局文件"),!1;for(var e in this.result)console.log(this.result.charCodeAt(e).toString(16)),coredata=this.result.substr(prefix.length),coredataChanged=!0}});